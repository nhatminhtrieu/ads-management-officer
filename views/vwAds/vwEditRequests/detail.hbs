{{#section "js"}}
  <script type="module">
    import CustomMap from "/static/js/map/CustomMap.js";
    import { contentAd } from "/static/js/loadMarker.js";
    import { updatePreview } from '/static/js/handleImgs.js' 
        
    const HomeMap = new CustomMap();
    HomeMap.init().then(() => { 
        const contentString = contentAd({{{json location }}});
        HomeMap.pushAdMarker({{{json location}}}, {{{json location.address}}}, contentString);
        HomeMap.setCenter({{{json location.coordinate }}});
    }); 

    let imgsArr = {{{json request.advertisement.imgs}}}

    window.onload = function () {
        updatePreview(imgsArr)
    }

    $("#cancelButton").click(function () { window.location.reload(); });
    $("#deleteButton").click(function (e) { 
        e.preventDefault();
        $.post("/advertisement/manage/delete/{{ad._id}}", function (response) {
            window.location.href = '/advertisement/manage'; 
        }) 
    });
  </script>
{{/section}}

<a
  class="btn p-0 link-primary"
  href="/advertisement/edit-request"
  role="button"
>
  <i class="bi bi-caret-left"></i>
  Trở về
</a>

<div id="map" style="height: 400px; width: 100%;" class="mt-3"></div>

<div class="d-flex justify-content-between">
  <div class="mt-3" style="display: flex; align-items: center;">
    <h4>Thông tin chi tiết yêu cầu chỉnh sửa</h4>
  </div>
</div>

<form method="POST">
  <div class="form-outline mt-3">
    <label class="form-label" for="address">Địa chỉ</label>
    <input
      type="text"
      id="address"
      class="form-control border-2"
      value="{{location.address}}"
      disabled
    />
  </div>

  {{#ifCond request.for "==" "location"}}
    <div class="form-outline mt-3">
      <div class="row g-3">
        <div class="col">
          <label class="form-label" for="number">Loại vị trí đặt quảng cáo
          </label>
          <input
            class="form-control border-2"
            value="{{request.location.type}}"
            disabled
          />
        </div>
        <div class="col">
          <label class="form-label" for="size">Loại hình quảng cáo
          </label>
          <input
            class="form-control border-2"
            value="{{request.location.format.name}}"
            disabled
          />
        </div>
      </div>
    </div>
  {{/ifCond}}

  {{#ifCond request.for "==" "advertisement"}}
    <div class="form-outline mt-3">
      <label class="form-label" for="typeBoard">Loại bảng quảng cáo</label>
      <input
        class="form-control border-2"
        disabled
        value="{{request.advertisement.typeBoard}}"
      />
    </div>
    <div class="form-outline mt-3">
      <div class="row g-3">
        <div class="col">
          <label class="form-label" for="number">Số lượng</label>
          <input
            type="text"
            id="number"
            class="form-control border-2"
            value="{{request.advertisement.number}}"
            disabled
          />
        </div>
        <div class="col">
          <label class="form-label" for="size">Kích thước</label>
          <input
            type="text"
            id="size"
            class="form-control border-2"
            value="{{request.advertisement.size}}"
            disabled
          />
        </div>
      </div>
    </div>
    <div class="form-outline mt-3">
      <label class="form-label" for="type">Hình ảnh bảng quảng cáo</label>
      <div class="row flex-nowrap overflow-auto" id="preview">
      </div>
    </div>
  {{/ifCond}}

    <div class="form-outline mt-3">
      <label class="form-label">Thời điểm xin chỉnh sửa</label>
      <input
        type="text"
        id="date"
        class="form-control border-2"
        value="{{formatDate request.createdAt}}"
        disabled
      />
    </div>
    <div class="form-outline mt-3">
      <label class="form-label" for="type">Lý do chỉnh sửa
      </label>
      <textarea
        class="form-control border-2"
        style="height: 100px"
        disabled
      >{{request.reason}}</textarea>
    </div>

  <input
    id="hidden-id-input"
    class="d-none"
    value="{{this.request._id}}"
    name="id"
    readonly
  />

  <div class="text-end">
    {{#ifCond request.createdBy '==' authUser._id}}
    <button
        class="btn btn-danger mt-3"
        formaction="/advertisement/edit-request/delete"
        {{#ifCond request.accepted '!==' 'pending' }} disabled {{/ifCond}}
    >
        Hủy yêu cầu
    </button>
    {{/ifCond}}
    {{#ifCond authUser.role '==' '3'}}
    <div class="mt-3">
        <button
        class="btn btn-danger"
        style="width: 150px"
        formaction="/advertisement/edit-request/reject"
        {{#ifCond request.accepted '!==' 'pending' }} disabled {{/ifCond}}
        >
        Từ chối
        </button>
        <button
        class="btn btn-success ms-2"
        style="width: 150px"
        formaction="/advertisement/edit-request/approve"
        {{#ifCond request.accepted '!==' 'pending' }} disabled {{/ifCond}}
        >
        Đồng ý
        </button>
    </div>
    {{/ifCond}}
  </div>
</form>